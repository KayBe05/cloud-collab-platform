{% extends "base.html" %}

{% block title %}Analytics - CloudX Platform{% endblock %}

{% block breadcrumb %}
<i class="fas fa-chart-bar"></i>
<i class="fas fa-chevron-right"></i>
<span>Analytics</span>
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='analytics.css') }}">
{% endblock %}

{% block content %}

<!-- ─── PAGE HEADER ──── -->
<header class="analytics-page-header">
  <div class="analytics-page-header__left">
    <h2 class="analytics-page-header__title">System Analytics</h2>
    <p class="analytics-page-header__subtitle">Real-time infrastructure monitoring &amp; event log</p>
  </div>

  <div class="analytics-page-header__controls">
    <!-- Live Pulse Badge -->
    <span class="live-badge">
      <span class="live-badge__dot"></span>
      Live
    </span>

    <!-- Time-Range Selector -->
    <select class="analytics-select" id="timeRangeSelect">
      <option value="1h">Last 1 Hour</option>
      <option value="6h">Last 6 Hours</option>
      <option value="24h" selected>Last 24 Hours</option>
      <option value="7d">Last 7 Days</option>
      <option value="30d">Last 30 Days</option>
    </select>

    <!-- Manual Refresh -->
    <button class="btn btn-secondary analytics-page-header__refresh" id="refreshBtn" title="Refresh all data">
      <i class="fas fa-sync-alt"></i>
    </button>
  </div>
</header>

<!-- ─── KPI CARDS ───────────────────────────────────────────── -->
<section class="kpi-grid">

  <!-- CPU Usage -->
  <article class="kpi-card" id="kpiCpu">
    <div class="kpi-card__icon kpi-card__icon--blue">
      <i class="fas fa-microchip"></i>
    </div>
    <div class="kpi-card__body">
      <span class="kpi-card__label">CPU Usage</span>
      <span class="kpi-card__value" id="cpuValue">45%</span>
      <div class="kpi-card__bar-track">
        <div class="kpi-card__bar-fill kpi-card__bar-fill--green" id="cpuBar" style="width:45%"></div>
      </div>
      <span class="kpi-card__sub" id="cpuSub">Normal load</span>
    </div>
  </article>

  <!-- Memory Usage -->
  <article class="kpi-card" id="kpiMemory">
    <div class="kpi-card__icon kpi-card__icon--purple">
      <i class="fas fa-memory"></i>
    </div>
    <div class="kpi-card__body">
      <span class="kpi-card__label">Memory Usage</span>
      <span class="kpi-card__value" id="memValue">4.2 GB / 8 GB</span>
      <div class="kpi-card__bar-track">
        <div class="kpi-card__bar-fill kpi-card__bar-fill--orange" id="memBar" style="width:52.5%"></div>
      </div>
      <span class="kpi-card__sub" id="memSub">52.5% utilized</span>
    </div>
  </article>

  <!-- Active Containers -->
  <article class="kpi-card" id="kpiContainers">
    <div class="kpi-card__icon kpi-card__icon--green">
      <i class="fab fa-docker"></i>
    </div>
    <div class="kpi-card__body">
      <span class="kpi-card__label">Active Containers</span>
      <span class="kpi-card__value" id="containerValue">12</span>
      <div class="kpi-card__status-row">
        <span class="kpi-card__status-dot kpi-card__status-dot--green"></span>
        <span class="kpi-card__sub" id="containerSub">All running</span>
      </div>
    </div>
  </article>

  <!-- Network I/O -->
  <article class="kpi-card" id="kpiNetwork">
    <div class="kpi-card__icon kpi-card__icon--orange">
      <i class="fas fa-network-wired"></i>
    </div>
    <div class="kpi-card__body">
      <span class="kpi-card__label">Network I/O</span>
      <span class="kpi-card__value" id="netValue">150 KB/s</span>
      <div class="kpi-card__io-row">
        <span class="kpi-card__io-item kpi-card__io-item--up">
          <i class="fas fa-arrow-up"></i>
          <span id="netUp">98 KB/s</span>
        </span>
        <span class="kpi-card__io-item kpi-card__io-item--down">
          <i class="fas fa-arrow-down"></i>
          <span id="netDown">52 KB/s</span>
        </span>
      </div>
    </div>
  </article>

</section>

<!-- ─── MAIN CHARTS ─────────────────────────────────────────── -->
<section class="charts-grid">

  <!-- Resource Utilization Trends (Line) -->
  <div class="analytics-card">
    <div class="analytics-card__header">
      <div>
        <h3 class="analytics-card__title">Resource Utilization Trends</h3>
        <p class="analytics-card__subtitle">CPU vs Memory over time</p>
      </div>
      <div class="analytics-card__legend">
        <span class="analytics-card__legend-item analytics-card__legend-item--cpu">
          <span class="analytics-card__legend-dot"></span> CPU
        </span>
        <span class="analytics-card__legend-item analytics-card__legend-item--mem">
          <span class="analytics-card__legend-dot"></span> Memory
        </span>
      </div>
    </div>
    <div class="analytics-card__chart">
      <canvas id="resourceTrendsChart"></canvas>
    </div>
  </div>

  <!-- Network Traffic (Area) -->
  <div class="analytics-card">
    <div class="analytics-card__header">
      <div>
        <h3 class="analytics-card__title">Network Traffic</h3>
        <p class="analytics-card__subtitle">Inbound vs Outbound (KB/s)</p>
      </div>
      <div class="analytics-card__legend">
        <span class="analytics-card__legend-item analytics-card__legend-item--inbound">
          <span class="analytics-card__legend-dot"></span> Inbound
        </span>
        <span class="analytics-card__legend-item analytics-card__legend-item--outbound">
          <span class="analytics-card__legend-dot"></span> Outbound
        </span>
      </div>
    </div>
    <div class="analytics-card__chart">
      <canvas id="networkTrafficChart"></canvas>
    </div>
  </div>

</section>

<!-- ─── SYSTEM LOGS ─────────────────────────────────────────── -->
<section class="analytics-card analytics-card--full">
  <div class="analytics-card__header">
    <div>
      <h3 class="analytics-card__title">System Logs</h3>
      <p class="analytics-card__subtitle">Recent platform events</p>
    </div>
    <div class="logs-filters">
      <button class="logs-filters__btn logs-filters__btn--active" data-filter="all">All</button>
      <button class="logs-filters__btn" data-filter="info">Info</button>
      <button class="logs-filters__btn" data-filter="warning">Warn</button>
      <button class="logs-filters__btn" data-filter="error">Error</button>
    </div>
  </div>

  <div class="logs-table-wrap">
    <table class="logs-table" id="logsTable">
      <thead>
        <tr>
          <th class="logs-table__th logs-table__th--timestamp">Timestamp</th>
          <th class="logs-table__th logs-table__th--severity">Severity</th>
          <th class="logs-table__th logs-table__th--service">Service</th>
          <th class="logs-table__th logs-table__th--message">Message</th>
        </tr>
      </thead>
      <tbody id="logsBody">
        <!-- Rows injected by analytics.js -->
      </tbody>
    </table>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='analytics.js') }}"></script>
{% endblock %}